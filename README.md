# Problem Statement
The goal is to calculate the average face embedding vector across a large dataset of
faces. And make it extensible.

# Installation
There are multiple ways to install.
(You need build-essential and cmake installed on your system before installing requirements,.txt)

- Using setup.py
```
python setup.py test
python setup.py sdist
pip install dist/face_embedding-0.0.1-py3-none-any.whl
```
- Using makefile
```
make test
make buildproject
make install
```
- Using docker file
```
docker pull ishanbhatt/veriff:test
```

# Prerequisite
- Download the dataset which has similar structure to http://vis-www.cs.umass.edu/lfw/#download
- Extract it and put that in some location in your system.

# How to run
- Without docker
```
from face_embedding import *
embedded_vectors = get_all_cf("/path/to/downloaded_file")
average_vector = get_average(embedded_vectors)
```

- With docker (given that you have pulled the image)
```
docker run -v /local_path/to/downloaded_files:images ishanbhatt/veriff:test
TOTAL FOLDERS FOUND 5749
100%|██████████| 5.75k/5.75k [10:18<00:00, 9.30it/s]
[-0.09184992  0.08891897  0.05172213 -0.03960983 -0.09545069 -0.0170844
 -0.01534049 -0.10618818  0.13509281 -0.05730249  0.20093566 -0.0379245
 -0.24540257 -0.04531504 -0.02827422  0.12434066 -0.14732012 -0.1192862
 -0.12448209 -0.08079314  0.01167066  0.0335183   0.03045237  0.0167361
 -0.1322308  -0.29926944 -0.07019538 -0.0890242   0.05684248 -0.09198239
  0.01209295  0.05314684 -0.1847007  -0.0599186   0.02795471  0.06273955
 -0.05172921 -0.06855772  0.20853005  0.01110339 -0.1675108   0.01483111
  0.05365956  0.24574812  0.20452459  0.00596853  0.02080457 -0.07223467
  0.11354043 -0.26228943  0.04808586  0.144542    0.11229019  0.07523396
  0.08312549 -0.14238386  0.02096773  0.1370085  -0.1820543   0.06994484
  0.06932121 -0.09159457 -0.0376186  -0.04275434  0.1620959   0.08735921
 -0.09012994 -0.13499565  0.16634363 -0.14129257 -0.04414149  0.07672209
 -0.08983798 -0.15972091 -0.26815942  0.03592251  0.37520292  0.12747033
 -0.17584331  0.01636036 -0.07415752 -0.02344868  0.03634182  0.03259635
 -0.07445394 -0.04941603 -0.09306157  0.02423752  0.19745308 -0.02871043
 -0.01720607  0.21492125  0.010714   -0.00624988  0.04012334  0.04733949
 -0.1107284  -0.01356372 -0.10988513 -0.01219312  0.04726631 -0.10606344
  0.00958324  0.08684939 -0.17421511  0.15863739 -0.01775398 -0.02408041
 -0.00742908 -0.02445264 -0.07560086  0.00209789  0.17316285 -0.25108418
  0.21515246  0.17408757 -0.00231636  0.1254312   0.06280041  0.06165447
 -0.00458359 -0.00511429 -0.13308913 -0.10946756  0.02851165 -0.02758148
  0.02185735  0.03925822]
```
You can also get individual celebrity face-vector as well for that you need to specify some settings using environment variable.
```
docker run -v /local_path/to/downloaded_files:/images -e METHOD=get_average -e CELEB=<celeb_name> ishanbhatt/veriff:test
[-0.05677064  0.07635128  0.03180838 -0.01788612 -0.11078423 -0.0460824
 -0.00294413 -0.18126798  0.11743522 -0.07864387  0.10802776 -0.11677291
 -0.27304122 -0.0548862  -0.05477985  0.09160107 -0.12363537 -0.10579572
 -0.1275085  -0.10866212 -0.02604463  0.0787836   0.02991759  0.00112934
 -0.08137593 -0.26614925 -0.04714679 -0.15463413  0.04128871 -0.07022936
 -0.01499949  0.07277815 -0.23317038 -0.09923515 -0.02488358  0.05570795
 -0.09571886 -0.06169527  0.20273705  0.02602412 -0.11464831 -0.02234083
  0.05233183  0.22744583  0.18150651 -0.0398024   0.00101692 -0.06186511
  0.16220395 -0.2716381   0.05671319  0.13304813  0.16649492  0.08279029
  0.15858687 -0.15802854  0.03711498  0.10948596 -0.18603139  0.14671238
  0.11628959 -0.05650336 -0.01217429 -0.04421913  0.18349807  0.06486916
 -0.01804166 -0.08264046  0.19134462 -0.13099627 -0.04754161  0.06881773
 -0.06560723 -0.1373485  -0.28356516  0.01817998  0.35877976  0.16267806
 -0.12550639  0.00729339 -0.12131792 -0.04832162  0.05859997 -0.05095237
 -0.05758663 -0.05335839 -0.08596214  0.04923891  0.17778556 -0.05272358
 -0.0476865   0.18774049 -0.03543841 -0.01920516  0.00715415 -0.03480484
 -0.13824153 -0.00681941 -0.09697612  0.01043392  0.05709383 -0.17395653
  0.0246458   0.07601989 -0.16107933  0.11379364 -0.01361498 -0.03141036
 -0.03597295 -0.05082886 -0.13909362  0.08430216  0.20297855 -0.24859278
  0.28559998  0.08550128 -0.03978551  0.1195228   0.01753688  0.03922654
 -0.03108519 -0.03915503 -0.13465668 -0.15951893  0.05755934  0.02329192
  0.02412048  0.09444857]
```
You can also find similarity between two celebrities as well. (Lower numbers means more similarity)
```
docker run -v /home/ishanbhatt/Downloads/lfw:/images -e METHOD=similarity_index -e CELEB1=Jack_Nicholson -e CELEB2=James_Baker ishanbhatt/veriff:test
Similarity index between Jack_Nicholson and James_Baker is  1.206
```

# Other
There are some assumptions and workarounds ,you can find them in Report and Performance Improvements. 
